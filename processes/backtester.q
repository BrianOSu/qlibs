
// --------------------------------------------------------------------------------------
// Env Variables
// --------------------------------------------------------------------------------------

ENV:`dev

// --------------------------------------------------------------------------------------
// Load libs
// --------------------------------------------------------------------------------------

.qlibs.load"../trade/trade.q"


// --------------------------------------------------------------------------------------
// Grab the initial data
// --------------------------------------------------------------------------------------

\l /home/brian/binance
data:?[`$.trade.crypto,"_1m";();0b;()]
candle_data:500#data
data:500_data


// --------------------------------------------------------------------------------------
// Buy selling Logic
// --------------------------------------------------------------------------------------

.backtest.testRow:{[row]
    candle_data,:row;
    $[.trade.side~`BUY;
        .trade.buy candle_data;
        .trade.sell[candle_data; last candle_data`close]]
 }

// --------------------------------------------------------------------------------------
// initialise
// --------------------------------------------------------------------------------------

show "------------------------------------------------"
show "Starting Backtest"
show "Testing: ",.trade.crypto
show "------------------------------------------------"

.backtest.testRow each data

show "------------------------------------------------"
show "Finished Backtest"
show "Performance: ",.Q.s1[.trade.performance[]],"%"
show "------------------------------------------------"