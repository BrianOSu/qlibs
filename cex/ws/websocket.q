//----------------------------------------------------------------------------------------------------------------------
// CEX Websocket API - https://cex.io/websocket-api-dsl
// Websocket API tends to crash on my machine
// .qlibs.load"../cex/ws/websocket.q"
//----------------------------------------------------------------------------------------------------------------------


//----------------------------------------------------------------------------------------------------------------------
// Load Libs
//----------------------------------------------------------------------------------------------------------------------

.qlibs.load"../cex/ws/keys.q"


//----------------------------------------------------------------------------------------------------------------------
// Cex Configs
//----------------------------------------------------------------------------------------------------------------------

.cex.url:`$":wss://api.plus.cex.io";


//----------------------------------------------------------------------------------------------------------------------
// Global Queries
//----------------------------------------------------------------------------------------------------------------------

.cex.ping:{
     .cex.h[.j.j enlist[`e]!enlist[`ping]]
 }


//----------------------------------------------------------------------------------------------------------------------
// Global Responses
//----------------------------------------------------------------------------------------------------------------------

// Ignore pong messages returned for pings
.cex.r.pong:{
    (::)
 }

//----------------------------------------------------------------------------------------------------------------------
// Websocket Functions to handle incoming data
//----------------------------------------------------------------------------------------------------------------------

.z.wc:{
  show "websocket closed";
  if[.cex.h~x;
    .cex.h:.cex.open[]]
 }